######################################
# Failing Infrastructure
# Original idea by: Tuttu
# Code by:          Tuttu
# Writing by:       ???
######################################

namespace = mem_failing_infrastructure

# Waiting at least 50 years before starting the event
planet_event = {
	id = mem_failing_infrastructure.1
	hide_window = yes
	
	trigger = {
		years_passed = 50
	}
	
	immediate = {
		set_global_flag = mem_failing_infrastructure_go
	}
}

# Randomly chosing the kind of infrastructure that will fail
planet_event = {
	id = mem_failing_infrastructure.2
	hide_window = yes
	is_triggered_only = yes
		
	trigger = {		
		has_global_flag = mem_failing_infrastructure_go
		is_homeworld = yes
		NOT = {	
			has_global_flag = mem_failing_infrastructure_started
		}		
	}
	
	mean_time_to_happen = {
		months = 24
		modifier = {
			# 3 times longer if materialist
			factor = 3
			OR = {
				has_ethic = "ethic_materialist"
				has_ethic = "ethic_fanatic_materialist"
			}
		}
	}
	
	immediate = {
		set_global_flag = mem_failing_infrastructure_started
		set_planet_flag = colony_event
		random_list = {
			10 = { # Transport
				planet_event = { id = mem_failing_infrastructure.10 }
				set_planet_flag = mem_failing_infrastructure_transport
			}
			10 = {  # Energy Production
				planet_event = { id = mem_failing_infrastructure.20 }
				set_planet_flag = mem_failing_infrastructure_energy_production
			}
			10 = { # Trash Removal
				planet_event = { id = mem_failing_infrastructure.30 }
				set_planet_flag = mem_failing_infrastructure_trash_removal
			} 
			10 = { # ???
				planet_event = { id = mem_failing_infrastructure.40 }
				set_planet_flag = mem_failing_infrastructure_???
			}		
		}
	}
}

# Transport Network - First Report of Failing
planet_event = {
	id = mem_failing_infrastructure.10
	title = "mem_failing_infrastructure.10.name"
	desc = "mem_failing_infrastructure.10.desc"
	picture = GFX_evt_metropolis
	show_sound = event_administrative_work
	location = FROM
	is_triggered_only = yes
	
	# Ask for report - Will get a chance to repair
	option = {
		name = "mem_failing_infrastructure.10.a"
		planet_event = { id = mem_failing_infrastructure.11 days = 45 random = 5 }
	}
	
	# Do nothing - Major failure will occur later
	option = {
		name = "mem_failing_infrastructure.10.b"

	}	
}

# Transport Network - First Major Failure
planet_event = {
	id = mem_failing_infrastructure.11
	title = "mem_failing_infrastructure.11.name"
	desc = "mem_failing_infrastructure.11.desc"
	picture = GFX_evt_metropolis
	show_sound = event_administrative_work
	location = FROM
	is_triggered_only = yes
	
	# Pay for reparation
	option = {
		name = "mem_failing_infrastructure.11.a"
		planet_event = { id = mem_failing_infrastructure.110 days = 45 random = 5 }
		Root.Owner = {
			add_mineral = 
			# TODO : ajouter paiement en mineral et energy
		}
	}
	
	# Don't pay
	option = {
		name = "mem_failing_infrastructure.11.b"
		planet_event = { id = mem_failing_infrastructure.120 days = 150 random = 15 }
	}	
	
	after = {
		add_modifier = {
			modifier = "mem_failing_infrastructure_unhappy_transport"
			days = 30
		}
	}
}