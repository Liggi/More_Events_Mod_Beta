######################
#    Wasted Talent   # 
#  By ViolentBeetle  #
######################

namespace = mem_wasted_talent

@MTTH = 6000
@MTTH_strange_mood = 12

@timer = 300
@timer_random = 300

#Hidden event. Picking up the leader.
country_event = {
	id = mem_wasted_talent.1
	hide_window = yes
	
	trigger = {
		# NOT = { has_global_flag = mem_wasted_talent_happened }
		NOT = { has_country_flag = mem_wasted_talent_happened }
		NOT = { has_ethic = ethic_hive_mind }
		is_country_type = default
		any_owned_leader = {
			leader_class = scientist
			OR = {
				is_researching_area = society
				is_researching_area = physics
				is_researching_area = engineering
			}
			NOT = { has_trait = leader_trait_scientist_synthetic }
			NOT = { has_trait = leader_trait_resilient }
		}
	}
	
	mean_time_to_happen = {
		months = @MTTH
		
		modifier = {
			factor = 0.1
			
			any_owned_leader = {
				leader_class = scientist
				OR = {
					is_researching_area = society
					is_researching_area = physics
					is_researching_area = engineering
				}
				NOT = { has_trait = leader_trait_scientist_synthetic }
				NOT = { has_trait = leader_trait_resilient }
				has_trait = leader_trait_substance_abuser
			}
		}
		
		modifier = {
			factor = 0.5
			
			any_owned_leader = {
				leader_class = scientist
				OR = {
					is_researching_area = society
					is_researching_area = physics
					is_researching_area = engineering
				}
				NOT = { has_trait = leader_trait_scientist_synthetic }
				NOT = { has_trait = leader_trait_resilient }
				has_trait = leader_trait_maniacal
			}
			
			NOT = {
				any_owned_leader = {
					leader_class = scientist
					OR = {
						is_researching_area = society
						is_researching_area = physics
						is_researching_area = engineering
					}
					NOT = { has_trait = leader_trait_scientist_synthetic }
					NOT = { has_trait = leader_trait_resilient }
					has_trait = leader_trait_substance_abuser
				}
			}
		}
		
		modifier = {
			factor = 0.8
			has_country_strategic_resource = { type = sr_zro amount > 0 }
		}
		
		modifier = {
			factor = 0.8
			has_country_strategic_resource = { type = sr_xuran amount > 0 }
		}
		
		modifier = {
			factor = 0.8
			has_country_strategic_resource = { type = sr_riggan amount > 0 }
		}
		
		modifier = {
			factor = 0.8
			has_country_strategic_resource = { type = sr_xuran amount > 0 }
		}
		
		
		modifier = {
			factor = 50
			is_ai = yes
		}
	}
	
	immediate = {
		set_global_flag = mem_wasted_talent_happened
		set_country_flag = mem_wasted_talent_happened
		random_owned_leader = {
			limit = {
				leader_class = scientist
				OR = {
					is_researching_area = society
					is_researching_area = physics
					is_researching_area = engineering
				}
				NOT = { has_trait = leader_trait_scientist_synthetic }
				NOT = { has_trait = leader_trait_resilient }
				has_trait = leader_trait_substance_abuser
			}
			save_event_target_as = wasted_leader
		}
		IF = {
			limit = { NOT = { exists = event_target:wasted_leader }  }
			random_owned_leader = {
				limit = {
					leader_class = scientist
					OR = {
						is_researching_area = society
						is_researching_area = physics
						is_researching_area = engineering
					}
					NOT = { has_trait = leader_trait_scientist_synthetic }
					NOT = { has_trait = leader_trait_resilient }
					has_trait = leader_trait_maniacal
				}
				save_event_target_as = wasted_leader
			}
		}
		IF = {
			limit = { NOT = { exists = event_target:wasted_leader }  }
			random_owned_leader = {
				limit = {
					leader_class = scientist
					OR = {
						is_researching_area = society
						is_researching_area = physics
						is_researching_area = engineering
					}
					NOT = { has_trait = leader_trait_scientist_synthetic }
					NOT = { has_trait = leader_trait_resilient }
				}
				save_event_target_as = wasted_leader
			}
		}
		event_target:wasted_leader = {
			set_leader_flag = mem_wasted_talent_leader
			remove_trait = leader_trait_substance_abuser
			add_trait = mem_wasted_talent_leader_trait
		}
		country_event = {
			id = mem_wasted_talent.2
		}
	}
}

#Player finds out about wasted leader
country_event = {
	id = mem_wasted_talent.2
	title = mem_wasted_talent.2.name
	desc = mem_wasted_talent.2.desc
	
	is_triggered_only = yes
	
	picture = GFX_evt_smugglers_in_bar
	
	option = {
		name = mem_wasted_talent.2.a
		custom_tooltip = mem_wasted_talent.2.a.tooltip
		set_country_flag = mem_wasted_talent_allowed
	}
	
	option = {
		name = mem_wasted_talent.2.b
		
		add_influence = -30
		
		event_target:wasted_leader = {
			remove_trait = mem_wasted_talent_leader_trait
		}
	}
}

#Leader begins construction
country_event = {
	id = mem_wasted_talent.3
	title = mem_wasted_talent.3.name
	desc = mem_wasted_talent.3.desc
	
	picture = GFX_evt_mem_laboratory
	
	trigger = {
		has_country_flag = mem_wasted_talent_allowed
		NOT = { has_country_flag = mem_wasted_talent_began }
		any_owned_leader = {
			has_leader_flag = mem_wasted_talent_leader
			OR = {
				is_researching_area = society
				is_researching_area = physics
				is_researching_area = engineering
			}
		}
	}
	
	mean_time_to_happen = {
		months = @MTTH_strange_mood
	}
	
	immediate = {
		set_country_flag = mem_wasted_talent_began
		random_owned_leader = {
			limit = { has_leader_flag = mem_wasted_talent_leader }
			save_event_target_as = wasted_leader
		}
	}
	
	option = {
		name = mem_wasted_talent.3.a
		custom_tooltip = mem_wasted_talent.3.a.tooltip
		
		add_modifier = {
			modifier = mem_wasted_talent_resource_drain
			days = -1
		}
		
		hidden_effect = {
			country_event = { id = mem_wasted_talent.4 days = @timer random = @timer_random }
		}
	}
	
	option = {
		name = mem_wasted_talent.3.b
		
		exile_leader_as = mem_wasted_talent_exiled_leader #Maybe there'll be a return
	}
}

#Event to determine what had science wrought
country_event = {
	id = mem_wasted_talent.4
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = { 
		exists = event_target:wasted_leader
	}
	
	immediate = {
		remove_modifier = mem_wasted_talent_resource_drain
		random_list = {
			1 = { country_event = { id = mem_wasted_talent.41 } } #Truth machine
			100 = { country_event = { id = mem_wasted_talent.42 } } #A robot
		}
	}
}

#Morality machine
country_event = {
	id = mem_wasted_talent.41
	title = mem_wasted_talent.41.name
	desc = mem_wasted_talent.41.desc
	
	is_triggered_only = yes
	
	picture = GFX_evt_mem_strange_apparatus
	
	option = {
		name = mem_wasted_talent.41.a
	}
	
	option = {
		name = mem_wasted_talent.41.b
		custom_tooltip = mem_wasted_talent.41.b.tooltip
		
		trigger = {
			OR = {
				has_ethic = ethic_materialist
				has_ethic = ethic_fanatic_materialist
			}
		}
		allow = {
			OR = {
				has_ethic = ethic_materialist
				has_ethic = ethic_fanatic_materialist
			}
		}
		
		hidden_effect = {
			shift_ethic = ethic_spiritualist
			shift_ethic = ethic_spiritualist
			
			every_owned_planet = {
				while = {
					count = 3
					random_owned_pop = {
						limit = { 
							is_robot_pop = no 
							is_enslaved = no 
							is_being_purged = no 
							NOT = { has_pop_flag = mem_wasted_talent_changed_ethic }
						}
						pop_change_ethic = ethic_spiritualist
						set_timed_pop_flag = { flag = mem_wasted_talent_changed_ethic days = 2 }
					}
				}
			}
		}
	}
	
	option = {
		name = mem_wasted_talent.41.c
		custom_tooltip = mem_wasted_talent.41.b.tooltip
		
		trigger = {
			OR = {
				has_ethic = ethic_spiritualist
				has_ethic = ethic_fanatic_spiritualist
			}
		}
		allow = {
			OR = {
				has_ethic = ethic_spiritualist
				has_ethic = ethic_fanatic_spiritualist
			}
		}
		
		hidden_effect = {
			shift_ethic = ethic_materialist
			shift_ethic = ethic_materialist
			
			every_owned_planet = {
				while = {
					count = 3
					random_owned_pop = {
						limit = { 
							is_robot_pop = no 
							is_enslaved = no 
							is_being_purged = no 
							NOT = { has_pop_flag = mem_wasted_talent_changed_ethic }
						}
						pop_change_ethic = ethic_materialist
						set_timed_pop_flag = { flag = mem_wasted_talent_changed_ethic days = 2 }
					}
				}
			}
		}
	}
	
	option = {
		name = mem_wasted_talent.41.d
		custom_tooltip = mem_wasted_talent.41.b.tooltip
		
		trigger = {
			OR = {
				has_ethic = ethic_militarist
				has_ethic = ethic_fanatic_militarist
			}
		}
		allow = {
			OR = {
				has_ethic = ethic_militarist
				has_ethic = ethic_fanatic_militarist
			}
		}
		
		hidden_effect = {
			shift_ethic = ethic_pacifist
			shift_ethic = ethic_pacifist
			
			every_owned_planet = {
				while = {
					count = 3
					random_owned_pop = {
						limit = { 
							is_robot_pop = no 
							is_enslaved = no 
							is_being_purged = no 
							NOT = { has_pop_flag = mem_wasted_talent_changed_ethic }
						}
						pop_change_ethic = ethic_pacifist
						set_timed_pop_flag = { flag = mem_wasted_talent_changed_ethic days = 2 }
					}
				}
			}
		}
	}
	
	option = {
		name = mem_wasted_talent.41.e
		custom_tooltip = mem_wasted_talent.41.b.tooltip
		
		trigger = {
			OR = {
				has_ethic = ethic_pacifist
				has_ethic = ethic_fanatic_pacifist
			}
		}
		allow = {
			OR = {
				has_ethic = ethic_pacifist
				has_ethic = ethic_fanatic_pacifist
			}
		}
		
		hidden_effect = {
			shift_ethic = ethic_militarist
			shift_ethic = ethic_militarist
			
			every_owned_planet = {
				while = {
					count = 3
					random_owned_pop = {
						limit = { 
							is_robot_pop = no 
							is_enslaved = no 
							is_being_purged = no 
							NOT = { has_pop_flag = mem_wasted_talent_changed_ethic }
						}
						pop_change_ethic = ethic_militarist
						set_timed_pop_flag = { flag = mem_wasted_talent_changed_ethic days = 2 }
					}
				}
			}
		}
	}
	
	option = {
		name = mem_wasted_talent.41.f
		custom_tooltip = mem_wasted_talent.41.b.tooltip
		
		trigger = {
			OR = {
				has_ethic = ethic_xenophile
				has_ethic = ethic_fanatic_xenophile
			}
		}
		allow = {
			OR = {
				has_ethic = ethic_xenophile
				has_ethic = ethic_fanatic_xenophile
			}
		}
		
		hidden_effect = {
			shift_ethic = ethic_xenophobe
			shift_ethic = ethic_xenophobe
			
			every_owned_planet = {
				while = {
					count = 3
					random_owned_pop = {
						limit = { 
							is_robot_pop = no 
							is_enslaved = no 
							is_being_purged = no 
							NOT = { has_pop_flag = mem_wasted_talent_changed_ethic }
						}
						pop_change_ethic = ethic_xenophobe
						set_timed_pop_flag = { flag = mem_wasted_talent_changed_ethic days = 2 }
					}
				}
			}
		}
	}
	
	option = {
		name = mem_wasted_talent.41.g
		custom_tooltip = mem_wasted_talent.41.g.tooltip
		
		trigger = {
			OR = {
				has_ethic = ethic_xenophobe
				has_ethic = ethic_fanatic_xenophobe
			}
		}
		allow = {
			OR = {
				has_ethic = ethic_xenophobe
				has_ethic = ethic_fanatic_xenophobe
			}
		}
		
		hidden_effect = {
			shift_ethic = ethic_xenophile
			shift_ethic = ethic_xenophile
			
			every_owned_planet = {
				while = {
					count = 3
					random_owned_pop = {
						limit = { 
							is_robot_pop = no 
							is_enslaved = no 
							is_being_purged = no 
							NOT = { has_pop_flag = mem_wasted_talent_changed_ethic }
						}
						pop_change_ethic = ethic_xenophile
						set_timed_pop_flag = { flag = mem_wasted_talent_changed_ethic days = 2 }
					}
				}
			}
		}
	}
}

country_event = {
	id = mem_wasted_talent.42
	title = mem_wasted_talent.42.name
	desc = mem_wasted_talent.42.desc
	
	is_triggered_only = yes
	
	picture = GFX_evt_robot_assembly_plant
	
	option = {
		name = mem_wasted_talent.42.a
		
		hidden_effect = {
			create_species = {
				name = "NAME_AI"
				class = AI
				portrait = random
				traits = random
			}
			create_leader = {
				type = scientist
				species = last_created
				name = random
				skill = 400
				traits = {
					trait = leader_trait_scientist_synthetic
					trait = mem_wasted_talent_science_robot_trait
					trait = leader_trait_maniacal
				}
			}
			last_created_leader = {
				set_leader_flag = mem_wasted_talent_robot
				save_event_target_as = the_robot
			}
		}
	}
	
	option = {
		name = mem_wasted_talent.42.b
		
		hidden_effect = {
			create_species = {
				name = "NAME_AI"
				class = AI
				portrait = random
				traits = random
			}
			create_leader = {
				type = governor
				species = last_created
				name = random
				skill = 400
				traits = {
					trait = leader_trait_governor_synthetic
					trait = mem_wasted_talent_governor_robot_trait
				}
			}
			last_created_leader = {
				set_leader_flag = mem_wasted_talent_robot
				save_event_target_as = the_robot
			}
		}
	}
	
	option = {
		name = mem_wasted_talent.42.c
		
		hidden_effect = {
			create_species = {
				name = "NAME_AI"
				class = AI
				portrait = random
				traits = random
			}
			create_leader = {
				type = admiral
				species = last_created
				name = random
				skill = 400
				traits = {
					trait = leader_trait_admiral_synthetic
					trait = mem_wasted_talent_admiral_robot_trait
				}
			}
			last_created_leader = {
				set_leader_flag = mem_wasted_talent_robot
				save_event_target_as = the_robot
			}
		}
	}
	
	after = {
		IF = {
			limit = { exists = event_target:the_robot }
			event_target:the_robot = {
				random_list = {
					5 = {  }
					1 = { set_name = "Pickles" }
					1 = { set_name = "NotMySynth" }
					1 = { set_name = "Stupid Tin Can" }
					1 = { set_name = "8675309" }
					1 = { set_name = "Who's Asking?" }
					1 = { set_name = "Buddy" }
					1 = { set_name = "A Thing!" }
					1 = { set_name = "Professor Feelbetter" }
					1 = { set_name = "What Has Science Wrought!" }
					1 = { set_name = "???" }
					1 = { set_name = "Clankity Clack" }
				}
			}
		}
	}
}